// @flow

import React from 'react';
import { withState } from 'recompose';
import { style } from 'glamor';
import BioTreeItem from './BioTreeItem';
import { search } from '../utils/biotree';

const expandedColor = style({
  color: '#267c2a',
});

const collapsedColor = style({
  color: '#2f487e',
});

const BioTreeView = ({ entities, type, expanded: ex, set, selectEntity, selectedEntity, query }) => {
  const expanded = ex || (query && entities.hits.edges.some(e => search(query, e).length));

  return (
    <div>
      {entities.hits.total > 0 &&
        <div onClick={e => { set(s => !s); e.stopPropagation(); }} className="tree-indent">
          <div className="tree">
            <i
              style={{ cursor: 'pointer' }}
              className={`
                fa
                ${expanded
                  ? `fa-minus-square ${expandedColor}`
                  : `fa-plus-square ${collapsedColor}`
                }
              `}
            />
            <span className="h5 type" style={{ textTransform: 'capitalize' }}>
              {type.p}
            </span>
          </div>

          {expanded && entities.hits.edges.map((entity, i) =>
            <BioTreeItem
              key={i}
              entity={entity.node}
              type={type}
              selectEntity={selectEntity}
              selectedEntity={selectedEntity}
              query={query}
            />
          )}
        </div>
      }
    </div>
  );
};

export default withState(
  'expanded',
  'set',
  props => !!props.entities.expanded || props.defaultExpanded
)(BioTreeView);
