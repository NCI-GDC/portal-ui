// @flow
import React from 'react';

export default function ({ api = API, value, field, slug, projectId }) {
  const filters = [
    {
      op: 'and',
      content: [
        ...(projectId ? [{ op: '=', content: { field: 'cases.project.project_id', value: projectId } }] : []),
        { op: '=', content: { field, value } },
      ],
    },
    {
      op: 'and',
      content: [
        ...(projectId ? [{ op: '=', content: { field: 'cases.project.project_id', value: projectId } }] : []),
        { op: 'excludeifany', content: { field, value } },
      ],
    },
  ];

  const url = `${api}analysis/survival?filters=${JSON.stringify(filters)}`;

  return fetch(url)
    .then(r => r.json())
    .then((rawData) => ({
      rawData,
      id: value,
      legend: [
        {
          key: `${slug}-mutated`,
          value: <span><span style={{ fontSize: '1.2em' }} >{slug || value}</span> mutated cases</span>,
        },
        {
          key: `${slug}-not-mutated`,
          value: <span><span style={{ fontSize: '1.2em' }} >{slug || value}</span> not mutated cases</span>,
        },
      ],
    }));
}
