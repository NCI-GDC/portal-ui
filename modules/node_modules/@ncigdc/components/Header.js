// @flow

import React from 'react';
import { connect } from 'react-redux';

import { dismissNotification } from '@ncigdc/dux/bannerNotification';

import nciGdcLogo from '@ncigdc/theme/images/NHI_GDC_DataPortal-logo.svg';

import HomeLink from '@ncigdc/components/Links/HomeLink';
import RepositoryLink from '@ncigdc/components/Links/RepositoryLink';
import CohortLink from '@ncigdc/components/Links/CohortLink';
import CartLink from '@ncigdc/components/Links/CartLink';
import ProjectsLink from '@ncigdc/components/Links/ProjectsLink';
import GDCAppsDropdown from '@ncigdc/components/GDCAppsDropdown';

import Banner from '@ncigdc/uikit/Banner';

const styles = {
  iconPadding: {
    paddingRight: '4px',
  },
};

const Header = ({ loggedIn, notifications, dispatch }) => (
  <header
    id="header" className="navbar navbar-default navbar-static-top"
      // data-ng-class="{ blue: hc.bannerDismissed }"
    role="banner"
  >

    {notifications.map(n => <Banner {...n} key={n.id} handleOnDismiss={() => dispatch(dismissNotification(n.id))} />)}

    <div className="container-fluid">
      <div className="navbar-header">
        <button type="button" className="navbar-toggle" data-ng-click="hc.toggleCollapsed()">
          <span className="sr-only" data-translate>Toggle navigation</span>
          <span className="icon-bar" />
          <span className="icon-bar" />
          <span className="icon-bar" />
        </button>
        <a
          id="gdc-logo"
          className="navbar-brand"
          tabIndex="0"
          style={{ padding: 0 }}
        >
          <img src={nciGdcLogo} alt="gdc-logo" />
        </a>
      </div>
      <nav
        className="navbar-collapse collapse navbar-responsive-collapse" data-uib-collapse="hc.isCollapsed"
        role="navigation" data-ng-click="hc.collapse($event)"
        tabIndex="-1"
        data-ng-keypress="hc.collapse($event)"
        aria-label="{{ 'Site Navigation' | translate }}"
      >
        <ul className="nav navbar-nav">
          <li
            data-ng-class="{ active: hc.$state.includes('home') }"
            id="header-projects"
          >
            {/* tabindexes */}
            <HomeLink>
              <i className="fa fa-home" style={styles.iconPadding} />
              <span className="hidden-sm" data-translate>Home</span>
            </HomeLink>
          </li>
          <li
            data-ng-class="{ active: hc.$state.includes('projects') }"
            id="header-projects"
          >
            <ProjectsLink>
              <i className="icon-gdc-projects" style={styles.iconPadding} />
              <span className="hidden-sm" data-translate>Projects</span>
            </ProjectsLink>
          </li>
          <li
            data-ng-class="{ active: hc.$state.includes('search') || hc.$state.includes('query') }"
            id="header-data"
          >
            <CohortLink>
              <i className="icon-gdc-data" style={styles.iconPadding} />
              <span className="hidden-sm" data-translate>Cohort</span>
            </CohortLink>
          </li>
          <li
            data-ng-class="{ active: hc.$state.includes('search') || hc.$state.includes('query') }"
            id="header-data"
          >
            <RepositoryLink>
              <i className="fa fa-database" style={styles.iconPadding} />
              <span className="hidden-sm" data-translate>Repository</span>
            </RepositoryLink>
          </li>
          <li id="header-data">
            <a
              href="https://gdc.nci.nih.gov/access-data/analytical-tools" tabIndex="0"
              target="_blank"
              rel="noopener noreferrer"
            >
              <i className="fa fa-bar-chart" style={styles.iconPadding} />
              <span className="hidden-sm" data-translate>Analysis</span>
            </a>
          </li>
        </ul>
        <ul className="nav navbar-nav navbar-right">
          <li>
            <a tabIndex="0">
              <i className="fa fa-search stock-icon" style={styles.iconPadding} />
              <span className="hidden-md hidden-sm" data-translate>Quick Search</span>
            </a>
          </li>
          {!loggedIn &&
            <li id="header-login">
              <a tabIndex="0">
                <i className="fa fa-sign-in" style={styles.iconPadding} />
                <span className="hidden-md hidden-sm" data-translate>Login</span>
              </a>
            </li>
          }
          {loggedIn &&
            <li className="hidden-xs">
              <ul className="nav navbar-nav username-list">
                <li className="btn-group" data-uib-dropdown>
                  <a href="" className="dropdown-toggle username" data-uib-dropdown-toggle aria-expanded="false">
                      hc.UserService.currentUser.username <span className="caret" />
                  </a>
                  <a href="" className="dropdown-toggle username-icon" data-uib-dropdown-toggle aria-expanded="false">
                    <span className="fa fa-user" /> <span className="caret" />
                    <span className="sr-only">User Dropdown</span>
                  </a>
                  <ul className="dropdown-menu" role="menu">
                    <li id="header-token">
                      <a
                        data-ng-click="hc.getToken()"
                        data-ng-keydown="$event.which === 13 && hc.getToken()"
                        tabIndex="0"
                      >
                        <i className="fa fa-file-zip-o stock-icon" />
                        <span data-translate>Download Token</span>
                      </a>
                    </li>
                    <li id="header-logout">
                      <a data-redirect="logout" tabIndex="0">
                        <i className="fa fa-sign-out stock-icon" />
                        <span data-translate>Logout</span>
                      </a>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
          }
          {loggedIn &&
            <li id="header-token" className="visible-xs">
              <a
                data-ng-click="hc.getToken()"
                data-ng-keydown="$event.which === 13 && hc.getToken()"
                tabIndex="0"
              >
                <i className="fa fa-file-zip-o stock-icon" />
                <span data-translate>Download Token</span>
              </a>
            </li>
          }
          {loggedIn &&
            <li id="header-logout" className="visible-xs">
              <a
                data-redirect="logout"
                tabIndex="0"
              >
                <i className="fa fa-sign-out stock-icon" />
                <span data-translate>Logout</span>
              </a>
            </li>
          }
          {/* if hc.cookieEnabled */}
          <li className="nav-cart">
            <CartLink>{count =>
              <span>
                <i className="fa fa-shopping-cart" style={styles.iconPadding} />
                <span className="hidden-md hidden-sm" style={styles.iconPadding}>Cart</span>
                <span className="label label-primary">{count}</span>
              </span>
            }</CartLink>
          </li>
          <li className="nav-GDCApps">
            <GDCAppsDropdown />
          </li>
        </ul>
      </nav>
    </div>
  </header>
);

export default connect(store => ({ notifications: store.bannerNotification }))(Header);
