<div class="container-fluid full-page">
  <div class="row search-panel">
    <div class="col-lg-3 col-md-4 facets-sidebar">
      <div class="panel panel-default">
        <div class="panel-heading clearfix">
          <h3 class="panel-title pull-left">Facets</h3>
        </div>
        <div class="list-group">
          <facets-free-text data-title="Project" field="project_code" placeholder="{{ 'Project Name or Code' | translate }}"></facets-free-text>
          <terms data-name="disease_type" data-title="Disease Type"
                 data-facet="prsc.projects.aggregations.disease_type"></terms>
          <terms data-name="project_code"
                 data-facet="prsc.projects.aggregations.project_code" data-title="Project Code"></terms>
          <terms data-name="program"
                 data-facet="prsc.projects.aggregations.program" data-title="Program"></terms>
          <terms data-name="status"
                 data-facet="prsc.projects.aggregations.status" data-title="Status"></terms>
          <terms data-name="_summary._analyzed_data.data_type"
                 data-facet="prsc.projects.aggregations['_summary._analyzed_data'].data_type" data-title="Data Type"></terms>
          <terms data-name="_summary._experimental_data.experimental_type"
                 data-facet="prsc.projects.aggregations['_summary._experimental_data'].experimental_type" data-title="Experimental Strategy"></terms>
        </div>
      </div>
    </div>
    <h4 class="col-lg-9 col-md-8" data-ng-if="!prsc.projects">
      <i class="fa fa-spinner fa-spin"></i> Loading projects...
    </h4>
    <h4 class="col-lg-9 col-md-8" data-ng-if="prsc.projects.hits.length === 0">
      No projects found using those filters.
    </h4>

    <div class="col-lg-9 col-md-8" data-ng-if="prsc.projects.hits.length > 0">
      <div class="alert alert-info clearfix">
        <span data-ng-if="!cfc.currentFilters.length">
          <i class="fa fa-long-arrow-left"></i> Start searching by selecting a facet
        </span>
        <current-filters></current-filters>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title table-heading">Projects ({{prsc.projects.pagination.total}})
            <div class="pull-right">
              <select-columns filters='projectColumns'></select-columns>
           </div>
          </h3>
        </div>
        <div class="table-responsive">
          <table id="project-table" class="table table-striped table-hover table-condensed table-bordered">
            <thead>
            <tr>
              <th ng-if="projectColumnIsEnabled('code')" scope="col" rowspan="2" data-translate>Code</th>
              <th ng-if="projectColumnIsEnabled('disease_type')" scope="col" rowspan="2" data-translate>Disease Type</th>
              <th ng-if="projectColumnIsEnabled('program')"  scope="col" rowspan="2" data-translate>Program</th>
              <th ng-if="projectColumnIsEnabled('participants')" scope="col" rowspan="2" data-translate>Participants</th>
              <th ng-if="projectColumnIsEnabled('available_data_files')" scope="col" colspan="6" rowspan="1" class="text-center" data-translate>
                Available Data Files per Data Type
              </th>
              <th ng-if="projectColumnIsEnabled('status')" scope="col" rowspan="2" data-translate>Status</th>
              <th ng-if="projectColumnIsEnabled('last_update')" scope="col" rowspan="2" data-translate>Last Update</th>
            </tr>
            <tr ng-if="projectColumnIsEnabled('available_data_files')" >
              <th scope="col" data-translate>Clinical</th>
              <th scope="col" data-translate>SNV</th>
              <th scope="col" data-translate>mRNA</th>
              <th scope="col" data-translate>miRNA</th>
              <th scope="col" data-translate>CNV</th>
              <th scope="col" data-translate>Meth</th>
            </tr>
            </thead>
            <tbody>
            <tr data-ng-repeat="p in prsc.projects.hits track by p.project_code">
              <td  ng-if="projectColumnIsEnabled('code')" ><a data-ui-sref="project({ projectId: p.project_code })">{{ ::p.project_code }}</a></td>
              <td ng-if="projectColumnIsEnabled('disease_type')">{{ ::p.disease_type }}</td>
              <td ng-if="projectColumnIsEnabled('program')">{{ ::p.program }}</td>
              <td ng-if="projectColumnIsEnabled('participants')" class="text-right">
                <a data-ui-sref="search.participants({ 'filters': makeFilter([
                  {
                    name: 'participants.admin.disease_code', value: p.project_code
                  }
                ])})">
                  {{ ::p._summary._participant_count | number:0 }}
                </a>
              </td>
              <td ng-if="projectColumnIsEnabled('available_data_files')" class="text-right">
                <a data-ui-sref="search.files({ 'filters': makeFilter([
                  {
                    name: 'participants.admin.disease_code', value: p.project_code
                  },
                  {
                    name: 'files.data_type', value: 'Clinical data'
                  }
                ])})">
                  {{ ::p._summary._analyzed_data["Clinical data"].file_count | number:0 }}
                </a>
              </td>
              <td ng-if="projectColumnIsEnabled('available_data_files')" class="text-right">
                <a data-ui-sref="search.files({ 'filters': makeFilter([
                  {
                    name: 'participants.admin.disease_code', value: p.project_code
                  },
                  {
                    name: 'files.data_type', value: 'Simple nucleotide variant'
                  }
                ])})">
                  {{ ::p._summary._analyzed_data["Simple nucleotide variant"].file_count | number:0 }}
                </a>
              </td>
              <td ng-if="projectColumnIsEnabled('available_data_files')" class="text-right">
                <a data-ui-sref="search.files({ 'filters': makeFilter([
                  {
                    name: 'participants.admin.disease_code', value: p.project_code
                  },
                  {
                    name: 'files.data_type', value: 'mRNA expression'
                  }
                ])})">
                  {{ ::p._summary._analyzed_data["mRNA expression"].file_count | number:0 }}
                </a>
              </td>
              <td ng-if="projectColumnIsEnabled('available_data_files')" class="text-right">
                <a data-ui-sref="search.files({ 'filters': makeFilter([
                  {
                    name: 'participants.admin.disease_code', value: p.project_code
                  },
                  {
                    name: 'files.data_type', value: 'miRNA expression'
                  }
                ])})">
                  {{ ::p._summary._analyzed_data["miRNA expression"].file_count | number:0 }}
                </a>
              </td>
              <td ng-if="projectColumnIsEnabled('available_data_files')" class="text-right">
                <a data-ui-sref="search.files({ 'filters': makeFilter([
                  {
                    name: 'participants.admin.disease_code', value: p.project_code
                  },
                  {
                    name: 'files.data_type', value: 'Copy number variant'
                  }
                ])})">
                  {{ ::p._summary._analyzed_data["Copy number variant"].file_count | number:0 }}
                </a>
              </td>
              <td ng-if="projectColumnIsEnabled('available_data_files')" class="text-right">
                <a data-ui-sref="search.files({ 'filters': makeFilter([
                  {
                    name: 'participants.admin.disease_code', value: p.project_code
                  },
                  {
                    name: 'files.data_type', value: 'DNA methylation'
                  }
                ])})">
                  {{ ::p._summary._analyzed_data["DNA methylation"].file_count | number:0 }}
                </a>
              </td>
              <td ng-if="projectColumnIsEnabled('status')" >{{ ::p.status }}</td>
              <td ng-if="projectColumnIsEnabled('last_update')" >{{ ::p.date | date }}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
