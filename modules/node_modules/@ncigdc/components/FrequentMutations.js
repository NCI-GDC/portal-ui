// @flow

import React from 'react';
import { compose, withState } from 'recompose';
import withSize from 'react-sizeme';

import { Row, Column } from '@ncigdc/uikit/Flex';
import withRouter from '@ncigdc/utils/withRouter';

import FrequentMutationsChart from '@ncigdc/containers/FrequentMutationsChart';
import FrequentMutationsTable from '@ncigdc/containers/FrequentMutationsTable';
import SurvivalPlotWrapper from '@ncigdc/components/SurvivalPlotWrapper';
import MutationTable from '@ncigdc/components/MutationTable';

import { withTheme } from '@ncigdc/theme';

declare var API: string;

const FrequentMutations = ({
  frequentMutationsChart,
  frequentMutationsTable,
  numCasesAggByProject,
  totalNumCases,
  setSelectedSurvivalData,
  selectedSurvivalData,
  defaultSurvivalRawData,
  projectId,
  defaultSurvivalLegend,
  showSurvivalPlot,
  theme,
  survivalPlotloading,
  size: {
    width,
  },
  cohort,
}) => {
  const survivalData = showSurvivalPlot && {
    legend: selectedSurvivalData.legend || defaultSurvivalLegend,
    rawData: selectedSurvivalData.rawData || defaultSurvivalRawData,
  };

  return (
    <Column>
      <div>
        <Row
          style={{
            paddingBottom: '2.5rem',
            ...(!showSurvivalPlot ? { justifyContent: 'center' } : {}),
          }}
        >
          <FrequentMutationsChart ssms={cohort.frequentMutationsChartFragment} />
          {showSurvivalPlot && (
            <span style={{ flexGrow: 1, flex: 1 }}>
              <SurvivalPlotWrapper
                {...survivalData}
                survivalPlotloading={survivalPlotloading}
                onReset={() => setSelectedSurvivalData({})}
                height={240}
                width={width}
              />
            </span>
          )}
        </Row>
        <FrequentMutationsTable ssms={cohort.frequentMutationsTableFragment} />
      </div>
    {/* {!frequentMutationsTable.length &&
      <span style={{ padding: '2rem' }}>No mutation data to display</span>
    } */}
    </Column>
  );
};

const enhance = compose(
  withState('selectedSurvivalData', 'setSelectedSurvivalData', {}),
  withTheme,
  withSize(),
  withRouter
);

export default enhance(FrequentMutations);
