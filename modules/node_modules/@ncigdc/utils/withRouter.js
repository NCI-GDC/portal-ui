// @flow
import React from 'react';
import { withRouter } from 'react-router-dom';
import { stringify, parse } from 'query-string';

const withBetterRouter = Wrapped => withRouter(({ push, ...props }) => {
  const betterPush = opts => {
    if (typeof opts === 'object') {
      push({
        pathname: opts.pathname,
        search: `?${stringify(opts.query)}`,
        state: opts.state,
      });
    } else push(opts);
  };

  return (
    <Wrapped
      {...props}
      push={betterPush}
      query={parse(props.location.search)}
    />
  );
});

export default withBetterRouter;
