// @flow
import React from 'react';
import Relay from 'react-relay';
import { lifecycle, compose } from 'recompose';
import { makeFilter } from '@ncigdc/utils/filters';
import { withTheme } from '@ncigdc/theme';

const MutationsCountComponent = compose(
  withTheme,
  lifecycle({
    componentDidMount(): void {
      this.props.relay.setVariables({
        fetchData: true,
        ssmsFilters: makeFilter([{ field: 'occurrence.case.case_id', value: this.props.caseId }], false),
      });
    },
  })
)(({
  mutationsCount,
  theme,
} = {}) => mutationsCount.hits ?
  <span>{mutationsCount.hits.total}</span> :
  <span style={{ backgroundColor: theme.greyScale4, minWidth: '10px', minHeight: '20px' }} >
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  </span>
);

export const MutationsCountQuery = {
  initialVariables: {
    ssmsFilters: null,
    fetchData: false,
  },
  fragments: {
    mutationsCount: () => Relay.QL`
      fragment on Ssms {
        blah: hits(first: 0) { total }
        hits(filters: $ssmsFilters) @include(if: $fetchData) {
          total
        }
      }
    `,
  },
};

const MutationsCount = Relay.createContainer(
  MutationsCountComponent,
  MutationsCountQuery
);

export default MutationsCount;
