// @flow

import React, { Children, cloneElement } from 'react';
import DownCaretIcon from 'react-icons/lib/fa/caret-down';
import * as styles from '@ncigdc/theme/mixins';
import withDropdown from './withDropdown';
import { Row, Column } from './Flex';
import UnstyledButton from './UnstyledButton';

const Dropdown = ({
  style,
  selected,
  active,
  setActive,
  mouseDownHandler,
  mouseUpHandler,
  children,
  dropdownStyle = {},
  itemStyle = {},
}) => (
  <UnstyledButton onClick={() => setActive(true)} style={{ position: 'relative', ...style }}>
    <Row style={styles.dropdownButton}>
      <span>{selected}</span>
      <DownCaretIcon style={{ marginLeft: 'auto' }} />
    </Row>
    {active &&
      <Column
        style={{ ...styles.dropdown, ...dropdownStyle }}
        onMouseDown={mouseDownHandler}
        onMouseUp={mouseUpHandler}
        onClick={() => setTimeout(() => setActive(false))}
      >
        {Children.map(children, child =>
          <Row className="dropdown-item">
            {cloneElement(child, {
              ...child.props,
              style: { ...(child.props || {}).style, ...styles.dropdownLink, ...itemStyle },
            })}
          </Row>
        )}
      </Column>
    }
  </UnstyledButton>
);

export default withDropdown(Dropdown);
