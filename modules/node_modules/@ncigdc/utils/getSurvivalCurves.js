// @flow

export default function ({ api = API, value, field, slug, projectId }) {
  const filters = [
    {
      op: 'and',
      content: [
        ...(projectId ? [{ op: '=', content: { field: 'cases.project.project_id', value: projectId } }] : []),
        { op: '=', content: { field, value } },
      ],
    },
    {
      op: 'and',
      content: [
        ...(projectId ? [{ op: '=', content: { field: 'cases.project.project_id', value: projectId } }] : []),
        { op: 'excludeifany', content: { field, value } },
      ],
    },
  ];

  const url = `${api}analysis/survival?filters=${JSON.stringify(filters)}`;

  return fetch(url)
    .then(r => r.json())
    .then((rawData) => ({
      rawData,
      id: value,
      legend: [
        `${slug || value} mutated cases`,
        `${slug || value} not mutated cases`,
      ],
    }));
}
