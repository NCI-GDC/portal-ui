/* @flow */

import Relay from 'react-relay';
import SearchTable from '@ncigdc/components/SearchTable';

export const CaseTableQuery = {
  fragments: {
    hits: () => Relay.QL`
      fragment on CaseConnection {
        total
        edges {
          node {
            id
            case_id
            project {
              project_id
              primary_site
            }
            annotations {
              hits(first:20) {
                total
                edges {
                  node {
                    annotation_id
                  }
                }
              }
            }
            demographic {
              gender
            }
            summary {
              data_categories {
                file_count
                data_category
              }
              file_count
            }

            files @include(if: $isFileDataRequired){
              hits(first:99) {
                edges {
                  node {
                    id
                    file_id
                    access
                    file_size
                    cases {
                      hits(first:1) {
                        edges {
                          node {
                            project {
                              project_id
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }

            filteredFiles: files @include(if: $isFilteredFileDataRequired){
              hits(first:99, filters: $filesFilters) {
                edges {
                  node {
                    id
                    file_id
                    access
                    file_size
                    cases {
                      hits(first:1) {
                        edges {
                          node {
                            project {
                              project_id
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    `,
  },
};

const CaseTable = Relay.createContainer(
  SearchTable,
  CaseTableQuery
);

export default CaseTable;
