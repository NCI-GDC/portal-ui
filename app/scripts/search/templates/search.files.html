<div class="panel panel-default">

  <div class="panel-heading">

    <h3 class="panel-title table-heading">
      <span data-translate>Files</span>
      <div class="pull-right">
        <div class="btn-group" role="group" aria-label="Filter and sort table">
        <sort-table data-sort-columns="sc.fileSortColumns"
                    data-paging="sc.files.pagination" data-page="files"></sort-table>
          <div table-filters-dropdown filters='searchFileColumns'></div>
        </div>
      </div>
    </h3>

  </div>
  <table id="file-table" class="table table-striped table-hover table-condensed table-bordered">
    <thead>
    <tr>
      <th class="text-center">
        <div class="btn-group" data-dropdown>
          <button data-ng-if="sc.CartService.areInCart(sc.files.hits)" type="button" class="btn btn-success" disabled>
            <i class="fa fa-check-circle"></i>
          </button>
          <button data-ng-if="!sc.CartService.areInCart(sc.files.hits)" type="button" class="btn btn-primary"
                  data-ng-click="sc.CartService.addFiles(sc.files.hits)">
            <i class="fa fa-shopping-cart"></i>
          </button>
          <button type="button" class="btn btn-default dropdown-toggle">
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu">
            <li>
              <a>
                <i class="fa fa-shopping-cart fa-stack"></i>
                <span data-translate>Add all in Search Result</span>
              </a>
            </li>
            <li>
              <a>
                <i class="fa fa-shopping-cart fa-stack"></i>
                <span data-translate>Remove all in Search Result</span>
              </a>
            </li>
          </ul>
        </div>
      </th>
      <th scope="col" class="text-center"
          data-ng-if="sc.UserService.currentUser"
          data-translate>
        My Projects
      </th>
      <th ng-if="fileColumnIsEnabled('access')" scope="col" class="text-center" data-translate>Access</th>
      <th ng-if="fileColumnIsEnabled('file_name')" scope="col" class="text-center" data-translate>File Name</th>
      <th ng-if="fileColumnIsEnabled('file_type')"  scope="col" class="text-center" data-translate>File type</th>
      <th ng-if="fileColumnIsEnabled('participants')"  scope="col" class="text-center" data-translate>Participants</th>
      <th ng-if="fileColumnIsEnabled('annotations')"  scope="col" class="text-center" data-translate>Annotations</th>
      <th ng-if="fileColumnIsEnabled('project')"  scope="col" class="text-center" data-translate>Project</th>
      <th ng-if="fileColumnIsEnabled('data_category')"  scope="col" class="text-center" data-translate>Data Category</th>
      <th ng-if="fileColumnIsEnabled('status')" scope="col" class="text-center" data-translate>Status</th>
      <th ng-if="fileColumnIsEnabled('size')"  scope="col" class="text-center" data-translate>Size</th>
      <th ng-if="fileColumnIsEnabled('revision')"  scope="col" class="text-center" data-translate>Revision</th>
      <th ng-if="fileColumnIsEnabled('update_date')"  scope="col" class="text-center" data-translate>Update date</th>
    </tr>
    </thead>
    <tbody>
    <tr data-ng-repeat="file in sc.files.hits track by file.file_uuid">
      <td class="text-center">
        <div class="btn-group" data-dropdown>
          <button data-ng-if="sc.CartService.isInCart(file.file_uuid)" type="button" class="btn btn-success" disabled>
            <i class="fa fa-check-circle"></i>
          </button>
          <button data-ng-if="!sc.CartService.isInCart(file.file_uuid)" type="button" class="btn btn-default"
                    data-ng-click="sc.addToCart([file])">
            <i class="fa fa-shopping-cart"></i>
          </button>
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                  aria-expanded="false">
            <span class="caret"></span>
            <span class="sr-only">Toggle Dropdown</span>
          </button>
          <ul class="dropdown-menu" role="menu">
            <li role="listitem"
                aria-label="{{ 'Download File' | translate }}">
              <a data-ng-href="{{ makeDownloadLink([file.file_uuid]) }}">
                <i class="fa-stack fa fa-cloud-download fa-stack"></i>
                <span data-translate>Download</span>
              </a>
            </li>
            <li role="listitem"
                aria-label="{{ 'Download File' | translate }}">
              <a data-ng-href="{{ makeDownloadLink([file.file_uuid]) }}">
                <i class="fa-stack fa fa-download fa-stack "></i>
                <span data-translate>Download File</span>
              </a>
            </li>
            <li role="listitem"
                aria-label="{{ 'Download Metadata' | translate }}">
              <a data-ng-href="{{ makeDownloadLink([file.file_uuid]) }}">
                <i class="fa fa-download fa-stack "></i>
                <span data-translate>Download Metadata</span>
              </a>
            </li>
            <li class="divider"></li>
            <li data-ng-if="file.archive.archive_uuid" role="listitem"
                aria-label="{{ 'Find Files in same archive' | translate }}">
              <a data-ng-href="search/f?filters={{ makeFilter([
                  { name: 'files.archive.archive_uuid', value: file.archive.archive_uuid }
                  ])}}">
                <i class="fa fa-file-zip-o fa-stack "></i>
                <span data-translate>Find Files in same archive</span>
              </a>
            </li>
            <li class="divider"></li>
            <li role="listitem"
                aria-label="{{ 'View Metadata Files' | translate }}">
              <a data-ng-href="/files/{{ file.file_uuid }}#files">
                <i class="fa fa-file-text-o fa-stack "></i>
                <span data-translate>View Metadata Files</span>
              </a>
            </li>
          </ul>
        </div>
      </td>
      <td scope="col" class="text-center"
          data-ng-if="sc.UserService.currentUser"
          data-translate>
        <i data-ng-if="sc.isUserProject(file)" class="fa fa-check fa-lg"></i>
        <i data-ng-if="!sc.isUserProject(file)" class="fa fa-close fa-lg"></i>
      </td>
      <td class="text-center" ng-if="fileColumnIsEnabled('access')">
        <i data-ng-if="file.data_access=='protected'" class="fa fa-lock fa-lg"></i>
        <i data-ng-if="file.data_access!='protected'" class="fa fa-unlock-alt fa-lg"></i>
      </td>
      <td ng-if="fileColumnIsEnabled('file_name')" >
        <a data-ui-sref="file({ fileId: file.file_uuid })">
          {{ ::file.file_name | ellipsicate }}
        </a>
      </td>


      <td data-ng-if="fileColumnIsEnabled('file_type')">{{ ::file.file_extension }}</td>
      <td data-ng-if="fileColumnIsEnabled('participants')" class="text-right">
      <td class="text-right">
        <span data-ng-if="::file.participants.length == 1"> 
          <a data-ui-sref="participant({'participantId':file.participants[0].bcr_patient_uuid})">
            {{ file.participants[0].bcr_patient_uuid | ellipsicate: 25 }} 
          </a>
        </span>
        <span data-ng-if="::file.participants.length > 1">
          <a data-ui-sref="search.participants({ 'filters': makeFilter([
              {
                name: 'files.file_uuid', value: file.file_uuid
              }
            ])})"> file.participants.length</a> </span>
      </td>
      <td ng-if="fileColumnIsEnabled('annotations')"  class="text-right">{{ ::file.annotations.length | number:0 }}</td>
      <td ng-if="fileColumnIsEnabled('project')">
        <a data-ui-sref="project({ projectId: file.project.id })">
          {{ ::file.archive.disease_code }}
        </a>
      </td>
      <td ng-if="fileColumnIsEnabled('data_category')">{{ ::file.data_type }}</td>
      <td ng-if="fileColumnIsEnabled('status')" >tbc {{ ::file.state }}</td>
      <td ng-if="fileColumnIsEnabled('size')" >{{ file.file_size | size }}</td>
      <td ng-if="fileColumnIsEnabled('revision')" >{{ ::file.archive.revision }}</td>
      <td ng-if="fileColumnIsEnabled('update_date')" >{{ file.modified | date }}</td>
    </tr>
    </tbody>
  </table>
  <div class="panel-footer clearfix">
    <pagination-controls data-page="files" data-paging="sc.files.pagination"></pagination-controls>
  </div>
</div>
