/* @flow */

import React from 'react';
import Relay from 'react-relay';

import { Row } from '@ncigdc/uikit/Flex';
import TableActions from '@ncigdc/components/TableActions';
import Showing from '@ncigdc/components/Pagination/Showing';

import { Tr, Th } from '@ncigdc/uikit/Table';

import ProjectTr from './ProjectTr';

import type { TTableProps } from './types';

const styles = {
  table: {
    width: '100%',
    borderCollapse: 'collapse',
    borderSpacing: 0,
  },
};

export const ProjectTableComponent = (props: TTableProps) => (
  <div>
    <Row style={{ backgroundColor: 'white', padding: '1rem', justifyContent: 'space-between' }}>
      <Showing
        docType="projects"
        params={props.relay.route.params}
        total={props.hits.total}
      />
      <TableActions
        prefix={'projects'}
        total={props.hits.total}
        sortKey="projects_sort"
        endpoint={`${API}/projects`}
        downloadFields={[
          'project_id',
          'primary_site',
          'disease_type',
          'program.name',
          'summary.case_count',
          'summary.file_count',
          'summary.file_size',
        ]}
        sortOptions={[
          {
            id: 'project_id.raw',
            name: 'ID',
          },
          {
            id: 'primary_site.raw',
            name: 'Primary Site',
          },
          {
            id: 'disease_type.raw',
            name: 'Disease Type',
          },
          {
            id: 'program.name',
            name: 'Program',
          },
          {
            id: 'summary.case_count',
            name: 'Cases',
          },
          {
            id: 'summary.file_count',
            name: 'Files',
          },
          {
            id: 'summary.file_size',
            name: 'File Size',
          },
        ]}
      />
    </Row>
    <div style={{ overflowX: 'auto' }}>
      <table style={styles.table}>
        <thead>
          <Tr>
            <Th rowSpan="2">ID</Th>
            <Th rowSpan="2">Disease Type</Th>
            <Th rowSpan="2">Primary Site</Th>
            <Th rowSpan="2">Program</Th>
            <Th rowSpan="2">Cases</Th>
            <Th colSpan="6">Available Cases per Data Category</Th>
            <Th rowSpan="2">Files</Th>
          </Tr>
          <Tr>
            <Th>Seq</Th>
            <Th>Exp</Th>
            <Th>SNV</Th>
            <Th>CNV</Th>
            <Th>Clinical</Th>
            <Th>Bio</Th>
          </Tr>
        </thead>
        <tbody>
          {props.hits.edges.map((e, i) => (
            <ProjectTr {...e} key={e.node.id} index={i} />
          ))}
        </tbody>
      </table>
    </div>
  </div>
);

export const ProjectTableQuery = {
  fragments: {
    hits: () => Relay.QL`
      fragment on ProjectConnection {
        total
        edges @relay(plural: true) {
          node {
            id
            ${ProjectTr.getFragment('node')}
          }
        }
      }
    `,
  },
};

const ProjectTable = Relay.createContainer(
  ProjectTableComponent,
  ProjectTableQuery
);

export default ProjectTable;
